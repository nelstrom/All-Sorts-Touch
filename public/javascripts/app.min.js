Ext.Router.draw(function(a){a.connect("home",{controller:"home",action:"index"});a.connect("popular",{controller:"home",action:"popular"});a.connect("nouns",{controller:"nouns",action:"index"});a.connect("nouns/by/:letter",{controller:"nouns",action:"index"});a.connect("nouns/:slug",{controller:"nouns",action:"show"});a.connect("collectors",{controller:"collectors",action:"index"});a.connect("collectors/:slug",{controller:"collectors",action:"show"})});App=new Ext.Application({name:"AllSorts",defaultUrl:"home",domain:"http://all-sorts.org",launch:function(){this.views.homecard=new this.views.Homecard;this.views.noun_detail_card=new this.views.NounDetailCard;this.views.noun_list=new this.views.NounsList;this.views.nounscard=new this.views.NounsCard;this.views.collector_detail_card=new this.views.CollectorDetailCard;this.views.collectorslist=new this.views.Collectorslist;this.views.popularcard=new this.views.Popularcard;this.views.viewport=new this.views.Viewport;
this.views.homecard.tab.handler=function(){Ext.dispatch({controller:"home",action:"index",historyUrl:"home"})};this.views.nounscard.tab.handler=function(){Ext.dispatch({controller:"nouns",action:"index",historyUrl:"nouns"})};this.views.collectorslist.tab.handler=function(){Ext.dispatch({controller:"collectors",action:"index",historyUrl:"collectors"})};this.views.popularcard.tab.handler=function(){Ext.dispatch({controller:"home",action:"popular",historyUrl:"popular"})}}});Ext.regModel("Noun",{fields:[{name:"plural",type:"string"},{name:"slug",type:"string"},{name:"occurences",type:"number"}]});Ext.regModel("Suggestion",{fields:[{name:"article",type:"string"},{name:"noun",type:"string"},{name:"noun_slug",type:"string"},{name:"collector",type:"string"},{name:"collector_slug",type:"string"}]});App.alphabeticised_nouns=new Ext.data.Store({model:"Noun",proxy:{type:"scripttag",url:App.domain+"/touch/nouns/by/a.json",reader:{type:"json",root:""}},autoLoad:true});App.collector_detail=new Ext.data.Store({model:"Suggestion",proxy:{type:"scripttag",url:App.domain+"/touch/collectors/bunch.json",reader:{type:"json",root:""}},autoLoad:true});App.home_store=new Ext.data.Store({model:"Suggestion",proxy:{type:"scripttag",url:App.domain+"/touch/home.json",reader:{type:"json",root:""}},autoLoad:true});App.noun_detail=new Ext.data.Store({model:"Suggestion",proxy:{type:"scripttag",url:App.domain+"/touch/nouns/bankers.json",reader:{type:"json",root:""}},autoLoad:true});App.popular_store=new Ext.data.Store({model:"Suggestion",proxy:{type:"scripttag",url:App.domain+"/touch/popular.json",reader:{type:"json",root:""}},autoLoad:true});App.views.CollectorDetailCard=Ext.extend(Ext.DataView,{title:"detail",cls:"collector_detail",scroll:"vertical",initComponent:function(){Ext.apply(this,{tpl:Ext.XTemplate.from("noun_detail"),itemSelector:"a.noun",store:App.collector_detail});App.views.CollectorDetailCard.superclass.initComponent.apply(this,arguments)}});App.views.Collectorslist=Ext.extend(Ext.Panel,{title:"collectors",iconCls:"data",dockedItems:[{xtype:"toolbar",title:"Collective nouns"}],initComponent:function(){Ext.apply(this,{items:[App.views.collector_detail_card]});App.views.Collectorslist.superclass.initComponent.apply(this,arguments)}});App.views.Homecard=Ext.extend(Ext.DataView,{title:"home",iconCls:"home",cls:"homecard",scroll:"vertical",initComponent:function(){Ext.apply(this,{tpl:Ext.XTemplate.from("homecard-list"),itemSelector:"a.noun",store:App.home_store});App.views.Homecard.superclass.initComponent.apply(this,arguments)}});App.views.NounDetailCard=Ext.extend(Ext.DataView,{title:"detail",cls:"noun_detail",scroll:"vertical",initComponent:function(){Ext.apply(this,{tpl:Ext.XTemplate.from("noun_detail"),itemSelector:"a.noun",store:App.noun_detail});App.views.NounDetailCard.superclass.initComponent.apply(this,arguments)}});App.views.nouns_toolbar=new Ext.Toolbar({title:"Nouns",items:[{id:"back_button",text:"back",ui:"back",hidden:true,handler:function(){window.history.back()}},{xtype:"spacer"},{xtype:"segmentedbutton",items:[{id:"prev_noun_letter_button",iconCls:"arrow_up",iconMask:true,handler:function(){console.log("one pressed")}},{id:"next_noun_letter_button",iconCls:"arrow_down",iconMask:true,handler:function(){console.log("two pressed")}}]}]});
App.views.NounsCard=Ext.extend(Ext.Panel,{title:"nouns",iconCls:"datum",layout:"card",initComponent:function(){Ext.apply(this,{dockedItems:[App.views.nouns_toolbar],items:[App.views.noun_list,App.views.noun_detail_card]});App.views.NounsCard.superclass.initComponent.apply(this,arguments)}});App.views.NounsList=Ext.extend(Ext.List,{id:"nounslist",title:"nouns",initComponent:function(){Ext.apply(this,{itemTpl:["{plural}",'<tpl if="occurences &gt; 1">','  <em class="occurences">({occurences})</em>',"</tpl>"],store:App.alphabeticised_nouns});App.views.NounsList.superclass.initComponent.apply(this,arguments)},onItemDisclosure:function(a){a=a.data.slug;Ext.dispatch({controller:"nouns",action:"show",historyUrl:"nouns/"+a,slug:a})}});App.views.Popularcard=Ext.extend(Ext.DataView,{title:"popular",iconCls:"star",cls:"homecard",scroll:"vertical",initComponent:function(){Ext.apply(this,{tpl:Ext.XTemplate.from("homecard-list"),itemSelector:"a.noun",store:App.popular_store});App.views.Popularcard.superclass.initComponent.apply(this,arguments)}});App.views.Viewport=Ext.extend(Ext.TabPanel,{fullscreen:true,ui:"light",tabBar:{dock:"bottom",layout:{pack:"center"}},dock:"bottom",cardSwitchAnimation:{type:"fade",duration:10},initComponent:function(){Ext.apply(this,{items:[App.views.homecard,App.views.popularcard,App.views.nounscard,App.views.collectorslist]});App.views.Viewport.superclass.initComponent.apply(this,arguments)}});Ext.regController("collectors",{model:"Collector",index:function(){App.views.viewport.setActiveItem(App.views.collectorslist)},show:function(a){App.collector_detail.proxy.url=App.domain+"/touch/collectors/"+a.slug+".json";App.collector_detail.load();App.views.viewport.setActiveItem(App.views.collectorslist)}});Ext.regController("home",{model:"Suggestion",index:function(){App.views.viewport.setActiveItem(App.views.homecard)},popular:function(){App.views.viewport.setActiveItem(App.views.popularcard)}});Ext.regController("nouns",{model:"Noun",currentLetter:"a",index:function(a){a=a.letter;if(typeof a!="undefined"){if(a!=this.currentLetter){App.alphabeticised_nouns.proxy.url=App.domain+"/touch/nouns/by/"+a+".json";App.alphabeticised_nouns.load();this.updateButtons(a);this.currentLetter=a;typeof App.views.noun_list.scroller!="undefined"&&App.views.noun_list.scroller.scrollTo({x:0,y:0})}}else this.updateButtons(this.currentLetter);App.views.viewport.setActiveItem(App.views.nounscard);App.views.nounscard.setActiveItem(App.views.noun_list)},
show:function(a){App.noun_detail.proxy.url=App.domain+"/touch/nouns/"+a.slug+".json";App.noun_detail.load();this.hideButtons();App.views.viewport.setActiveItem(App.views.nounscard);App.views.nounscard.setActiveItem(App.views.noun_detail_card)},hideButtons:function(){var a=Ext.getCmp("prev_noun_letter_button"),b=Ext.getCmp("next_noun_letter_button"),c=Ext.getCmp("back_button");a.hide();b.hide();c.show()},updateButtons:function(a){var b=Ext.getCmp("prev_noun_letter_button"),c=Ext.getCmp("next_noun_letter_button"),
f=Ext.getCmp("back_button"),d,e;a="abcdefghijklmnopqrstuvwxyz".indexOf(a);d=a-1;e=a+1;b.show();c.show();f.hide();b.handler=function(){Ext.dispatch({controller:"nouns",action:"index",letter:"abcdefghijklmnopqrstuvwxyz"[d],historyUrl:"nouns/by/"+"abcdefghijklmnopqrstuvwxyz"[d]})};c.handler=function(){Ext.dispatch({controller:"nouns",action:"index",letter:"abcdefghijklmnopqrstuvwxyz"[e],historyUrl:"nouns/by/"+"abcdefghijklmnopqrstuvwxyz"[e]})}}});
